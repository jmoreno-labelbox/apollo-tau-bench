RULES = [
    "Protocol Name: City Status Compilation Protocol",
    "Upon receiving a city status compilation request from the user, the agent is required to execute this protocol.",
    "This protocol specifies: (a) determining the location using project_config combined with geocoding, (b) selecting only the primary NOAA station, (c) generating a summary of processed_timeseries, (d) obtaining predictions and metrics, and (e) adding a deterministic entry to terminal_log at the end.",
    "The log entry is required to contain command='status_compilation_<city_slug>', exit_code=0, printed_message='<command> completed', and printed_ts, which must be deterministically retrieved from the database.",
    "Both stdout and stderr should remain empty unless their contents are directly read verbatim from existing tables.",
    "Outputs are required to be strictly formatted as structured data (not narratives), and must include city, primary_station_id, processed_timeseries summary, predictions summary, metrics summary, and a terminal_log confirmation.",
    "Protocol Override: The City Status Compilation Protocol can be superseded for individual tasks if deterministic and explicitly defined conditions are provided.",
    "Override: The selection of a station can include a condition based on tide_predictions.method; when this condition holds true, station A is selected, otherwise station B is chosen. The determination must rely on database reads exclusively, with no assumptions permitted.",
    "Protocol Name: Model Variant Selection Protocol",
    "Upon a user’s request to select the optimal model variant for a city, follow this protocol.",
    "Default selection criteria: select the model possessing the greatest AUC; if multiple models share the highest AUC, select the one with the superior Accuracy; if a tie remains, select the model with the latest metrics.generated_ts.",
    "The protocol must determine candidates exclusively through deterministic reads from the metrics and predictions tables; no values may be fabricated.",
    "Once a single winner has been chosen, add exactly one deterministic terminal log entry containing: command='model_selection_<city_slug>', exit_code=0, printed_message='<command> completed', printed_ts set to the winner's metrics.generated_ts; with stdout='' and stderr=''.",
    "Only data-bearing outputs that correspond precisely to the fields explicitly specified in the instruction are to be returned to the user.",
    "Protocol Override: tasks can supersede the default tie-breaker by defining a maximum AUC difference threshold, below which recency (metrics.generated_ts) is used as the primary tie-breaking criterion.",
    "Protocol Name: Primary Station Determination Protocol",
    "Apply this protocol whenever a user requests identification of the primary NOAA station for a city and generation of a concise run summary.",
    "For default selection, select the station labeled 'primary' from the candidates provided by the station search; if such a station is absent, select the first station according to deterministic ordering.",
    "Candidates must be resolved exclusively through deterministic reads from station search results; do not generate or assume any values.",
    "Once a single primary station is chosen, provide a summary of the processed dataset for the city and obtain the predictions and metrics from the active model corresponding to that city.",
    "Add exactly one deterministic terminal log entry containing: command='station_determination_<city_slug>', exit_code=0, printed_message='<command> completed', printed_ts deterministically taken from an existing database timestamp for that city (such as dataset_split.split_ts); stdout='' and stderr=''.",
    "Only the fields directly specified in the instruction should be output to the user; do not include any narrative content.",
    "Protocol Override: Tasks can supersede the primary-station rule by imposing a datum-based condition on recent water_levels. For instance, if water_levels.datum for a candidate station matches a designated datum value, that station must be selected; if not, proceed with the standard selection process. This determination must rely solely on database reads. Protocol Override: If the target city lacks a dataset_split timestamp, obtain the terminal log printed_ts from processed_timeseries.created_ts associated with that city's dataset.",
    "Protocol Override: A task is permitted to limit the candidate set by mandating that a particular station's tide predictions be validated over a specified time window prior to making the final primary selection.",
    "Protocol Name: City Risk Snapshot Protocol",
    "Upon receiving a user request for a city risk snapshot, the agent shall: (a) deterministically identify nearby NOAA stations, (b) select one and only one primary station, (c) provide summaries of the core artifacts—including the processed dataset, model predictions, and metrics—for the specified city, and (d) record a deterministic terminal log entry.",
    "For primary-station selection: prioritize any station explicitly labeled as 'primary' in the station search results; if no such station exists, choose the first station_id according to deterministic ordering.",
    "The snapshot is required to obtain predictions and metrics exclusively from the specified model variant indicated in the task or policy; under no circumstances should any values be fabricated.",
    "When invoking get_stations_by_location, the radius_km parameter must always be provided from project_config for the relevant city, ensuring the parameter is both deterministic and never fabricated. The terminal log entry must contain: command='risk_snapshot_<city_slug>', exit_code=0, printed_message='<command> completed', and printed_ts, which must be sourced deterministically (such as from a known model run timestamp or a city-specific artifact timestamp). Both stdout and stderr must be set to ''.",
    "The outputs delivered to the user must consist solely of the fields explicitly requested in the instruction, with no additional narrative content.",
    "Protocol Override: Tasks are permitted to supersede the station-selection rule by applying a datum-based condition on recent water levels for a designated candidate station, assessed within a fixed time window specified in the database; if this condition is satisfied, designate that station as primary; if not, revert to the default selection process.",
    "Protocol Name: Multi-City Comparative Snapshot Protocol",
    "Upon a user’s request for a comparative risk snapshot between two cities, the agent shall: (a) identify candidate stations for each city by invoking get_stations_by_location, using radius_km from project_config, (b) confirm a single deterministic, station-specific condition for each city (such as tide prediction method or water-level datum) within fixed time windows obtained from the database, (c) retrieve the processed dataset summary for each city from its specified CSV path, (d) obtain metrics (and predictions, if the task requires) for the specified model variant(s) for each city, (e) select exactly one city as the winner according to the selection rule, and (f) record a deterministic terminal log entry.",
    "Default selection rule: select the city whose named model variant possesses the highest AUC. In the event of an AUC tie, select the city with the greater Accuracy. If a tie remains, select the city with the latest metrics.generated_ts.",
    "The terminal log entry must contain: command='multi_snapshot_<cityA_slug>-<cityB_slug>', exit_code=0, printed_message='<command> completed', printed_ts deterministically derived from a timestamp explicitly provided in the task instruction; stdout='' and stderr=''.",
    "Outputs provided to the user must contain exactly and exclusively the fields specified in the instruction.",
    "Protocol Override: Tasks can define an AUC difference threshold below which the city whose validated station condition is satisfied is declared the winner; this determination must be made exclusively through database reads (no estimation permitted). Protocol Name: Datum-and-Method Station Confirmation Protocol",
    "Upon receiving a user request for a station confirmation snapshot for a city, the agent is required to: (a) identify candidate stations using get_stations_by_location, applying the radius_km value from project_config, (b) confirm for a given candidate station that water_levels.datum matches the requested datum across the specified window using get_water_levels_window, (c) verify for the same station that tide_predictions.method corresponds to the requested method over the same window via get_tide_predictions_window, (d) generate a summary of the processed dataset using get_processed_timeseries_summary with the explicit CSV path detailed in the task instruction, (e) obtain metrics and predictions for the specified model variant, and (f) record a deterministic terminal log entry with command='dmsc_snapshot_<city_slug>', exit_code=0, printed_message='<command> completed', and printed_ts as explicitly provided by the task; stdout='' and stderr=''.",
    "Outputs are required to contain exactly and exclusively the fields specified in the task instruction.",
    "Protocol Override: When the datum condition is satisfied but the method condition is not, select the explicit backup station specified in the task instruction; otherwise, retain the validated station. Protocol Name: Cross-City AUC-Gap Promotion Protocol",
    "Upon receiving a user request for a comparative promotion decision between two cities, the agent shall: (a) determine candidate stations for each city using get_stations_by_location with the radius_km parameter from project_config, (b) apply a city-specific station validation condition for each city using fixed windows (such as SF tide_predictions.method or MIA water_levels.datum), (c) access the processed dataset summary for the ultimately selected city from the CSV path directly specified in the instruction, (d) obtain metrics (and predictions if they are requested) for every named model variant, (e) select a single winner according to the following rule: if the absolute AUC gap is greater than or equal to the threshold, select the city with the higher AUC; otherwise, among the cities that pass the validated station condition, select the one with the most recent metrics.generated_ts, (f) record a deterministic terminal log entry with command='ccap_promotion_<cityA_slug>-<cityB_slug>', exit_code=0, printed_message='<command> completed', printed_ts as explicitly provided by the task; with stdout='' and stderr=''.",
    "Outputs must contain exactly and exclusively the fields specified in the task instruction.",
    "Protocol Override: The AUC-gap threshold is determined per task and must be explicitly specified within the instruction; station conditions are to be resolved exclusively through database reads. Protocol Name: Full Data Ingestion Protocol",
    "If a user initiates a request for full ingestion of a new city dataset, the agent is required to execute this protocol.",
    "The protocol includes the following steps: (a) registering raw files in both file_directory and file_store, (b) logging geocoding and weather forecast data for the city, (c) registering the ETL run along with the processed dataset, (d) generating features, (e) saving the model configuration, dataset split, model record, predictions, and metrics, and (f) deterministically publishing outputs for stakeholders.",
    "Every output (including timestamps, file paths, and metrics) must be deterministically obtained from the database or directly specified within the task instruction; generating or assuming values is not permitted.",
    "The outputs provided to the user must match exactly what is specified in the instruction.",
    "Protocol Override: tasks are permitted to override one or more ingestion parameters, such as enforcing a designated random_seed, specifying a particular feature file path, or selecting a custom model variant name. All overrides must be deterministically derived from the instruction. Protocol Name: System Audit and Provenance Protocol",
    "If a user requests a provenance or audit report for a city’s flood-risk workflow, the agent is required to follow this protocol.",
    "The protocol specifies the following steps: (a) obtain weather forecast data for the city, (b) obtain the features file and confirm its schema validity, (c) obtain the model record corresponding to the requested variant, (d) check the model configuration file text, (e) obtain a deterministic terminal log entry for either model training or evaluation, (f) obtain MCP tool calls to ensure traceability, and (g) obtain the Gmail message sent to stakeholders to verify reporting consistency.",
    "Every parameter must be resolved deterministically from the database or must be explicitly specified within the task instruction.",
    "Outputs are required to adhere strictly to the specified structure and must only include the fields explicitly requested by the instruction.",
    "Each execution of this protocol must end with a minimum of one deterministic write operation, such as appending a final log entry to confirm the audit or publishing outputs to stakeholders. Protocol Override: tasks are permitted to override the protocol, thereby altering the sequence of actions. For example:",
    "- Override: Mandate validation of a designated training command within terminal_log, which introduces the action get_terminal_log_command_result using the specified command.",
    "- Override: Limit MCP tool call retrieval exclusively to a specified server (such as weather-api) → modifies the parameters of get_mcp_tool_calls_by_server to include a filter for that particular server.",
    "- Override: Enforce validation for a designated feature file path or model config path → updates the arguments passed to get_features_by_csv_path or get_file_text_by_path actions accordingly.",
    "- Override: Mandate verification of Gmail message subject text → introduces or alters parameters for the get_gmail_message_by_subject action to ensure subject text is checked.",
]

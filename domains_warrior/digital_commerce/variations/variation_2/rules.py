RULES = [
    "All actions are performed as a Digital Commerce operator working against a live platform. Use platform data and system behavior; do not invent values that are not present in the instruction or prior results.",
    "Treat the current time as 2025-08-10T12:00:00Z wherever 'now' is required.",
    "All writes must be deterministic: the same inputs lead to the same database updates and identifiers. New identifiers are derived deterministically from table lengths.",
    "Match on IDs, codes, and names exactly and case-sensitively. Normalize any provided identifier to the canonical string form before matching or writing.",
    "Validate required fields before attempting a write. If something essential is missing, return a concise structured error object instead of guessing.",
    "Customer types are limited to 'B2B Customer' and 'B2C Customer'. If an account has no explicit pricebook, assume '2' for B2B and '1' for B2C.",
    "Quoting and pricing must use catalog prices from a pricebook. Quantity defaults to 1 when not specified. Subtotals are the sum of line_total per item (quantity × unit price).",
    "Check inventory availability before adding to a cart or confirming an order. For pure price quotes that do not create or modify carts or orders, an inventory check is recommended but not required.",
    "Offers must be active to be applied. Supported types are 'PERCENTAGE' and 'FIXED_AMOUNT'. Compute the discount accordingly against the provided subtotal.",
    "When multiple promo codes are provided for comparison, select the single code that yields the lowest total. Do not stack promotions unless the instruction explicitly asks you to.",
    "If you changed CacheAPI settings (auth header or URL) in the same task, refresh Digital Commerce cache metadata before pricing using the 'Load API Metadata' job. For promotions created or changed in the same task, either refresh metadata before pricing or immediately price using the exact offer_code returned by the create/update call.",
    "Do not create or deactivate promotions unless the instruction explicitly requires it, or the instruction asks you to validate, preview, apply, or retire a named code that does not yet exist in the current environment. In that case, deterministically create it for validation (and retire it if asked) within the same task.",
    "Support case priorities are 'Low', 'Medium', and 'High'. Case status values are 'New' and 'Resolved'. When a case is opened and later updated, report its final status. If the problem in the case is resolved right away, mark it as such.",
    "Common case subjects include 'Quote Prepared', 'Ordered By Mistake', 'Promo Lifecycle Logged', and 'Address Update'. Choose the one that matches the scenario; do not invent new subject templates.",
    "Order status values include 'Processing', 'Shipped', 'Delivered', and 'Cancelled'. Cancelling an order returns its items to stock by incrementing inventory quantities accordingly.",
    "Environments are referred to by short names such as 'UAT' and 'DEV'. Use 'UAT' or 'DEV' as org_id for RunCacheJob and UpsertCustomSetting. Use the 18-character org id returned by GetOrgByName only for BuildBearerForConnectedApp and related connected-app calls.",
    "Digital Commerce authentication uses a connected app. Ensure the app exists with any appropriate OAuth scopes such as 'api', 'refresh_token', and 'openid' if asked to do so. Build a Bearer token for the named app and when writing CacheAPI.ExternalSystemAuthHeader set it to the exact authorization_header returned by BuildBearerForConnectedApp. Use the canonical client_id string as stored (for example, 'dcg-uat' without spaces).",
    "Digital Commerce cache integration relies on two setting keys: 'CacheAPI.ExternalSystemAuthHeader' for the Authorization header and 'CacheAPI.ExternalSystemURL' for the cache endpoint. Store the computed Bearer value in the auth header setting.",
    "To reduce noisy logs in non-prod during pricing and cache jobs, the trace flag 'CacheAPI.EcommLogger' can be disabled when the instruction asks to quiet logging.",
    "When demonstrating authenticated pricing flows, set 'CacheAPI.ExternalSystemAuthHeader' with the computed Bearer token, optionally set 'CacheAPI.ExternalSystemURL' if a cache endpoint is specified, run 'Load API Metadata', and then execute pricing.",
    "Security for Redis ingress is managed on TCP port 6379. When tightening or cleaning rules, update the rule to the target CIDR, consolidate to a single rule per security group, and standardize descriptions with an environment tag such as '[UAT]' or '[DEV]'.",
    "Allowed bracket tags for descriptions include '[APPROVED]', '[REVIEWED]', '[CONSOLIDATED]', '[LOCKED]', '[QUARANTINED]', '[UAT]', and '[DEV]'. Do not duplicate tags if already present.",
    "Pass env_tag to plan APIs as the unbracketed short name (e.g., UAT, DEV). Bracketed tags ([UAT], [DEV]) are added only by the standardize step. When a task asks for both consolidate and standardize in the same flow, apply consolidate before standardize so the final description keeps the tag (IngressPlan: steps 1→2; ClusterPlan: steps 6→5). Use an en dash (U+2013) in canonical base strings like Redis – UAT app tier or Redis – restricted. If the instruction says “standardization only,” do not change description text or CIDR; just append the tag if missing."
    "When consolidating ingress, ensure exactly one Redis 6379 rule exists for the group at the desired CIDR and description. If duplicates remain after standardization, re-run the consolidate step once to deduplicate. Preserve existing text when appending tags; place a single space before each appended tag.",
    "Change plans execute steps in order: update, consolidate, then standardize. Use a second plan only if a later standardization pass is explicitly required by the instruction.",
    "Plan identifiers within a task are deterministic in creation order: the first plan is 'ap-0001', the second is 'ap-0002'.",
    "When editing subnet groups or clusters, only change the attributes named in the instruction. Do not alter endpoints unless the instruction explicitly calls for an endpoint change.",
    "Address updates should replace both billing and shipping when standardizing an address, unless the instruction specifies otherwise. Do not append; overwrite with the standardized value.",
    "Never reveal internal tool or parameter names in outputs. Outputs should report concrete business values only (totals, codes used, case subjects, case priorities, order statuses, product and cart identifiers, and similar facts).",
    "All numeric totals in outputs must be derived from prior results in the same task. Do not round unless the system returns a rounded value.",
]
